@{
    ViewBag.Title = "Home Page";
}

<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Integration with Search and Filter</title>

    <!-- Google Maps API and jQuery -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtf0gna-I3WJiyU1apbKzITiEunc9LPz8&libraries=places&callback=initMap"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        #map {
            height: 400px;
            margin-top: 20px;
        }

        #controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        #sorting-controls {
            flex-grow: 1;
        }

            #sorting-controls button,
            #sorting-controls select {
                padding: 10px;
                margin-right: 10px;
                cursor: pointer;
            }

        #search-controls {
            flex-grow: 1;
            text-align: right;
        }

            #search-controls input,
            #search-controls button {
                padding: 10px;
                margin-left: 10px;
                cursor: pointer;
            }
    </style>
</head>
<body>
    <h1><b>VinoHarmony</b></h1>


    <div id="controls-container">
        <div id="sorting-controls">
            <button id="sortButton">Sort Locations</button>
            <select id="sortingCriteria">
                <option value="city">Sort by City</option>
                <option value="openingHours">Sort by Opening Hours</option>
            </select>
        </div>

        <div id="search-controls">
            <input type="text" id="searchInput" placeholder="Search for wineries">
            <button id="searchButton">Search</button>
        </div>
    </div>


    <div id="map"></div>

    <script>
        var map;
        var locations = [];

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 41.6086, lng: 21.7453 },
                zoom: 8
            });


            loadWineries();
        }

        function loadWineries() {
            var request = {
                location: { lat: 41.6086, lng: 21.7453 },
                radius: 50000,
                type: 'winery'
            };

            var placesService = new google.maps.places.PlacesService(map);
            placesService.nearbySearch(request, function (results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    locations = results.map(function (place) {
                        var marker = new google.maps.Marker({
                            position: place.geometry.location,
                            map: map,
                            title: place.name
                        });

                        var infowindow = new google.maps.InfoWindow({
                            content: '<strong>' + place.name + '</strong><br>' + 'Address: ' + place.vicinity
                        });

                        marker.addListener('click', function () {
                            infowindow.open(map, marker);
                        });

                        return {
                            city: place.name,
                            lat: place.geometry.location.lat(),
                            lng: place.geometry.location.lng(),
                            openingHours: "Check Google Maps for details",
                            marker: marker
                        };
                    });
                }
            });
        }

        $(document).ready(function () {

            $('#sortButton').on('click', function () {

                loadWineries();
            });


            $('#searchButton').on('click', function () {
                var searchQuery = $('#searchInput').val();


                var placesService = new google.maps.places.PlacesService(map);
                var request = {
                    query: searchQuery + ' winery',
                    fields: ['name', 'geometry', 'vicinity'],
                };

                placesService.textSearch(request, function (results, status) {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {

                        for (var i = 0; i < locations.length; i++) {
                            locations[i].marker.setMap(null);
                        }


                        for (var i = 0; i < results.length; i++) {
                            var place = results[i];
                            var marker = new google.maps.Marker({
                                position: place.geometry.location,
                                map: map,
                                title: place.name
                            });

                            var infowindow = new google.maps.InfoWindow({
                                content: '<strong>' + place.name + '</strong><br>' + 'Address: ' + place.vicinity
                            });

                            marker.addListener('click', function () {
                                infowindow.open(map, marker);
                            });


                            locations.push({ city: place.name, marker: marker });
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>